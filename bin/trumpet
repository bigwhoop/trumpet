#!/usr/bin/env php
<?php
namespace Trumpet;

use Bigwhoop\Trumpet\Exceptions\Exception;
use Bigwhoop\Trumpet\HTTP\Server;
use DI\Container as DIC;

$autoloadFilePaths = [
    __DIR__.'/../vendor/autoload.php',
    __DIR__.'/../../../autoload.php'
];

$autoloadFilePath = false;
foreach ($autoloadFilePaths as $path) {
    if (file_exists($path)) {
        $autoloadFilePath = $path;
        break;
    }
}

if (!$autoloadFilePath) {
    echo "Failed to locate composer's autoload.php.\n";
    exit(1);
}

require $autoloadFilePath;

/** @var DIC $dic */
$dic = require __DIR__ . '/../app/etc/di.php';

/** @var Server $server */
$server = $dic->get('Bigwhoop\Trumpet\HTTP\Server');

try {
    $server->listen();
} catch (Exception $e) {
    printf("[%s] %sL%d\n%s\n", get_class($e), $e->getFile(), $e->getLine(), $e->getMessage());
}